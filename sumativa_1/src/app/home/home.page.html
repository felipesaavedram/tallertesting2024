<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Ficha Médica</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card>
    <ion-card-header>
      <ion-card-title>Ingrese sus datos</ion-card-title>
    </ion-card-header>
    <ion-card-content>

      <!-- Buscador por apellido -->
      <ion-searchbar
        style="margin-bottom: 20px;"
        placeholder="Buscar por apellido"
        (ionInput)="buscarPorApellido($event)"
      ></ion-searchbar>

      <!-- Tabla de resultados de búsqueda -->
      <ion-list *ngIf="filteredRecords.length > 0">
        <ion-item *ngFor="let record of filteredRecords">
          <ion-label>
            RUT: {{ record.rut }}<br>
            Nombre: {{ record.nombres }}<br>
            Apellido: {{ record.apellidos }}<br>
          </ion-label>
        </ion-item>
      </ion-list>

      <!-- Formulario -->
      <ion-input
        type="text"
        id="rut"
        required
        minlength="8"
        maxlength="12"
        pattern="^(\d{1,3}(?:\.\d{1,3}){2}-[\dkK])$"
        fill="solid"
        label="RUT"
        labelPlacement="floating"
        helperText="Ej: 12.345.678-9"
        errorText="Rut Inválido"
        [(ngModel)]="formData.rut"
      ></ion-input>

      <ion-input
        type="text"
        id="nombres"
        required
        minlength="8"
        maxlength="50"
        fill="solid"
        label="Nombres"
        labelPlacement="floating"
        helperText="Ej: Pedro Pablo"
        errorText="Nombre Inválido"
        [(ngModel)]="formData.nombres"
      ></ion-input>

      <ion-input
        type="text"
        id="apellidos"
        required
        minlength="8"
        maxlength="50"
        fill="solid"
        label="Apellidos"
        labelPlacement="floating"
        helperText="Ej: Pérez Pereira"
        errorText="Apellido Inválido"
        [(ngModel)]="formData.apellidos"
      ></ion-input>

      <ion-input
        type="text"
        id="direccion"
        required
        minlength="10"
        maxlength="70"
        fill="solid"
        label="Dirección"
        labelPlacement="floating"
        helperText="Ingresa una dirección válida"
        errorText="Dirección Inválida"
        [(ngModel)]="formData.direccion"
      ></ion-input>

      <ion-input
        type="text"
        id="ciudad"
        required
        minlength="3"
        maxlength="25"
        fill="solid"
        label="Ciudad"
        labelPlacement="floating"
        helperText="Ingresa una ciudad válida"
        errorText="Ciudad Inválida"
        [(ngModel)]="formData.ciudad"
      ></ion-input>

      <ion-input
        type="tel"
        id="telefono"
        required
        minlength="8"
        maxlength="9"
        fill="solid"
        label="Teléfono"
        labelPlacement="floating"
        helperText="Ej: 9 1234 5678"
        errorText="Teléfono Inválido"
        [(ngModel)]="formData.telefono"
      ></ion-input>

      <ion-input
        type="email"
        id="correo"
        required
        minlength="4"
        pattern="^([a-zA-Z0-9_\-\.]+)@([a-zA-Z0-9_\-\.]+)\.([a-zA-Z]{2,5})$"
        fill="solid"
        label="Correo Electrónico"
        labelPlacement="floating"
        helperText="Ej: correo@electronico.cl"
        errorText="Correo Electrónico Inválido"
        [(ngModel)]="formData.correo"
      ></ion-input>

      <ion-input
        type="date"
        id="fechaNacimiento"
        required
        fill="solid"
        label="Fecha de Nacimiento"
        labelPlacement="floating"
        errorText="Fecha de Nacimiento Inválida"
        [(ngModel)]="formData.fechaNacimiento"
      ></ion-input>

      <ion-select
        style="margin-bottom: 20px; margin-left: 5px; margin-right: 5px"
        required
        label="Estado Civil"
        label-placement="floating"
        [(ngModel)]="formData.estadoCivil"
      >
        <ion-select-option value="Soltero(a)">Soltero(a)</ion-select-option>
        <ion-select-option value="Casado(a)">Casado(a)</ion-select-option>
        <ion-select-option value="Conviviente Civil">Conviviente Civil</ion-select-option>
        <ion-select-option value="Divorciado(a)">Divorciado(a)</ion-select-option>
      </ion-select>

      <ion-textarea
        style="height: 100px;"
        label="Comentarios"
        labelPlacement="floating"
        fill="solid"
        placeholder="Ingrese sus comentarios"
        [counter]="true"
        maxlength="500"
        [(ngModel)]="formData.comentarios"
      ></ion-textarea>

      <div style="text-align: center; margin: 30px;">
        <!-- Botones -->
        <ion-button (click)="guardarData()">Guardar</ion-button>
        <ion-button (click)="limpiarFormulario()">Limpiar</ion-button>
        <ion-button (click)="cerrarFormulario()">Cerrar</ion-button>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>